From 5efc6f7d1ce249fb03b16cb99b7a9f105cc6b880 Mon Sep 17 00:00:00 2001
From: Erfan Abdi <erfangplus@gmail.com>
Date: Thu, 17 Jun 2021 01:39:59 +0800
Subject: [PATCH 2/6] Zygote: Disable seccomp

Change-Id: Ia29148f887a6fdcbc65803a4dec1a881b353df95
---
 core/jni/com_android_internal_os_Zygote.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/core/jni/com_android_internal_os_Zygote.cpp b/core/jni/com_android_internal_os_Zygote.cpp
index f0b41b03..a95ae24b 100644
--- a/core/jni/com_android_internal_os_Zygote.cpp
+++ b/core/jni/com_android_internal_os_Zygote.cpp
@@ -631,7 +631,7 @@ static void PreApplicationInit() {
   mallopt(M_DECAY_TIME, 1);
 }
 
-static void SetUpSeccompFilter(uid_t uid, bool is_child_zygote) {
+/*static void SetUpSeccompFilter(uid_t uid, bool is_child_zygote) {
   if (!gIsSecurityEnforced) {
     ALOGI("seccomp disabled by setenforce 0");
     return;
@@ -647,7 +647,7 @@ static void SetUpSeccompFilter(uid_t uid, bool is_child_zygote) {
   } else {
     set_system_seccomp_filter();
   }
-}
+}*/
 
 static void EnableKeepCapabilities(fail_fn_t fail_fn) {
   if (prctl(PR_SET_KEEPCAPS, 1, 0, 0, 0) == -1) {
@@ -1686,7 +1686,7 @@ static void SpecializeCommon(JNIEnv* env, uid_t uid, gid_t gid, jintArray gids,
   // alternative is to call prctl(PR_SET_NO_NEW_PRIVS, 1) afterward, but that
   // breaks SELinux domain transition (see b/71859146).  As the result,
   // privileged syscalls used below still need to be accessible in app process.
-  SetUpSeccompFilter(uid, is_child_zygote);
+  //SetUpSeccompFilter(uid, is_child_zygote);
 
   // Must be called before losing the permission to set scheduler policy.
   SetSchedulerPolicy(fail_fn, is_top_app);
-- 
2.30.2

